<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Testing - RealtyAssistant AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            color: #fff;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            padding: 20px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: white;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.2s;
        }

        .nav-link:hover,
        .nav-link.active {
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .voice-container {
            text-align: center;
            max-width: 600px;
        }

        .title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
            margin-bottom: 50px;
            line-height: 1.6;
        }

        /* Voice Button */
        .voice-button-container {
            position: relative;
            margin-bottom: 40px;
        }

        .voice-button {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
        }

        .voice-button:hover:not(.recording) {
            transform: scale(1.05);
            box-shadow: 0 15px 50px rgba(102, 126, 234, 0.5);
        }

        .voice-button.recording {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: pulse-glow 1.5s infinite;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.5);
            }

            50% {
                box-shadow: 0 0 0 30px rgba(239, 68, 68, 0);
            }
        }

        .voice-button svg {
            width: 60px;
            height: 60px;
            fill: white;
        }

        .voice-button.recording svg {
            animation: pulse-icon 1s infinite;
        }

        @keyframes pulse-icon {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        /* Ripple effect */
        .ripple {
            position: absolute;
            width: 160px;
            height: 160px;
            border-radius: 50%;
            border: 2px solid rgba(102, 126, 234, 0.3);
            animation: ripple-out 2s infinite;
        }

        .ripple:nth-child(2) {
            animation-delay: 0.5s;
        }

        .ripple:nth-child(3) {
            animation-delay: 1s;
        }

        @keyframes ripple-out {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .voice-button.recording~.ripple {
            border-color: rgba(239, 68, 68, 0.3);
        }

        /* Status Text */
        .status-container {
            margin-bottom: 40px;
        }

        .status-text {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .status-hint {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        /* Transcript */
        .transcript-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            min-height: 150px;
            margin-bottom: 30px;
        }

        .transcript-label {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .transcript-text {
            font-size: 1.1rem;
            line-height: 1.6;
            min-height: 60px;
        }

        .transcript-text.placeholder {
            color: rgba(255, 255, 255, 0.3);
            font-style: italic;
        }

        /* Response Area */
        .response-container {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            display: none;
        }

        .response-container.visible {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .response-label {
            font-size: 0.85rem;
            color: #667eea;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .response-text {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* Waveform Visualization */
        .waveform-container {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            margin-bottom: 20px;
        }

        .waveform-bar {
            width: 4px;
            height: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            transition: height 0.1s ease;
        }

        .waveform-bar.active {
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            animation: wave 0.5s ease-in-out infinite alternate;
        }

        @keyframes wave {
            from {
                height: 10px;
            }

            to {
                height: 50px;
            }
        }

        .waveform-bar:nth-child(1) {
            animation-delay: 0s;
        }

        .waveform-bar:nth-child(2) {
            animation-delay: 0.1s;
        }

        .waveform-bar:nth-child(3) {
            animation-delay: 0.2s;
        }

        .waveform-bar:nth-child(4) {
            animation-delay: 0.3s;
        }

        .waveform-bar:nth-child(5) {
            animation-delay: 0.4s;
        }

        .waveform-bar:nth-child(6) {
            animation-delay: 0.3s;
        }

        .waveform-bar:nth-child(7) {
            animation-delay: 0.2s;
        }

        .waveform-bar:nth-child(8) {
            animation-delay: 0.1s;
        }

        .waveform-bar:nth-child(9) {
            animation-delay: 0s;
        }

        /* API Status */
        .api-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50px;
            font-size: 0.85rem;
            margin-top: 30px;
        }

        .api-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #48bb78;
        }

        .api-dot.offline {
            background: #f56565;
        }

        /* Conversation History */
        .history-container {
            width: 100%;
            max-width: 500px;
            margin-top: 40px;
            display: none;
        }

        .history-container.visible {
            display: block;
        }

        .history-title {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .history-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 16px;
        }

        .history-item.user {
            border-left: 3px solid #667eea;
        }

        .history-item.bot {
            border-left: 3px solid #48bb78;
        }

        .history-role {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .history-content {
            font-size: 0.95rem;
            line-height: 1.5;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <a href="index.html" class="logo">
            <div class="logo-icon">üè†</div>
            <span class="logo-text">RealtyAssistant</span>
        </a>
        <nav class="nav-links">
            <a href="index.html" class="nav-link">Chat Demo</a>
            <a href="voice.html" class="nav-link active">Voice Testing</a>
            <a href="#" class="nav-link" onclick="showApiDocs()">API Docs</a>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="voice-container">
            <h1 class="title">Voice Assistant</h1>
            <p class="subtitle">
                Speak naturally to find your perfect property. Click the microphone and describe what you're looking for.
            </p>

            <!-- Waveform -->
            <div class="waveform-container" id="waveform">
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
                <div class="waveform-bar"></div>
            </div>

            <!-- Voice Button -->
            <div class="voice-button-container">
                <div class="ripple"></div>
                <div class="ripple"></div>
                <div class="ripple"></div>
                <button class="voice-button" id="voiceButton" onclick="toggleRecording()">
                    <svg id="micIcon" viewBox="0 0 24 24">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                    </svg>
                </button>
            </div>

            <!-- Status -->
            <div class="status-container">
                <p class="status-text" id="statusText">Click to start speaking</p>
                <p class="status-hint" id="statusHint">Press and speak, then click again to stop</p>
            </div>

            <!-- Transcript -->
            <div class="transcript-container">
                <div class="transcript-label">üìù Your Input</div>
                <div class="transcript-text placeholder" id="transcript">
                    Your spoken words will appear here...
                </div>
            </div>

            <!-- Response -->
            <div class="response-container" id="responseContainer">
                <div class="response-label">üè† Assistant Response</div>
                <div class="response-text" id="responseText"></div>
            </div>

            <!-- Conversation History -->
            <div class="history-container" id="historyContainer">
                <div class="history-title">
                    üí¨ Conversation History
                </div>
                <div class="history-list" id="historyList">
                    <!-- History items will be added here -->
                </div>
            </div>

            <!-- API Status -->
            <div class="api-status">
                <div class="api-dot" id="apiDot"></div>
                <span id="apiStatus">Checking server...</span>
            </div>
        </div>
    </main>

    <script>
        // Configuration
        const API_URL = 'http://localhost:8080';

        // State
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];
        let conversationHistory = [];

        // Check API status on load
        checkApiStatus();
        setInterval(checkApiStatus, 30000);

        async function checkApiStatus() {
            const dot = document.getElementById('apiDot');
            const status = document.getElementById('apiStatus');

            try {
                const response = await fetch(`${API_URL}/api/status`);
                if (response.ok) {
                    dot.classList.remove('offline');
                    status.textContent = 'Server connected';
                } else {
                    throw new Error('Server error');
                }
            } catch (error) {
                dot.classList.add('offline');
                status.textContent = 'Server offline - Demo mode';
            }
        }

        async function toggleRecording() {
            const button = document.getElementById('voiceButton');
            const statusText = document.getElementById('statusText');
            const statusHint = document.getElementById('statusHint');
            const waveformBars = document.querySelectorAll('.waveform-bar');

            if (isRecording) {
                // Stop recording
                isRecording = false;
                button.classList.remove('recording');
                statusText.textContent = 'Processing...';
                statusHint.textContent = 'Please wait';
                waveformBars.forEach(bar => bar.classList.remove('active'));

                if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                    mediaRecorder.stop();
                }
            } else {
                // Start recording
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = (event) => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = async () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        await processAudio(audioBlob);
                        stream.getTracks().forEach(track => track.stop());
                    };

                    mediaRecorder.start();
                    isRecording = true;
                    button.classList.add('recording');
                    statusText.textContent = 'Listening...';
                    statusHint.textContent = 'Click again when done speaking';
                    waveformBars.forEach(bar => bar.classList.add('active'));

                } catch (error) {
                    console.error('Microphone error:', error);
                    statusText.textContent = 'Microphone access denied';
                    statusHint.textContent = 'Please allow microphone access in your browser';
                }
            }
        }

        async function processAudio(audioBlob) {
            const transcript = document.getElementById('transcript');
            const statusText = document.getElementById('statusText');
            const statusHint = document.getElementById('statusHint');

            // For demo, we'll simulate transcription
            // In production, this would send to Whisper API

            // Show processing state
            transcript.textContent = 'Transcribing your voice...';
            transcript.classList.remove('placeholder');

            // Simulate transcription delay
            await new Promise(resolve => setTimeout(resolve, 1500));

            // Demo transcription (in production, this would come from Whisper)
            const demoTranscripts = [
                "I'm looking for a 2 BHK apartment in Mumbai, Andheri West with a budget of around 80 lakhs",
                "Can you help me find a 3 bedroom flat in Pune near IT Park?",
                "I need a commercial shop in Delhi for about 50 lakhs",
                "Looking for residential property in Bangalore, preferably Whitefield area"
            ];

            const randomTranscript = demoTranscripts[Math.floor(Math.random() * demoTranscripts.length)];
            transcript.textContent = randomTranscript;

            // Add to history
            addToHistory('user', randomTranscript);

            // Get AI response
            await getAIResponse(randomTranscript);

            statusText.textContent = 'Click to speak again';
            statusHint.textContent = 'Continue the conversation';
        }

        async function getAIResponse(userMessage) {
            const responseContainer = document.getElementById('responseContainer');
            const responseText = document.getElementById('responseText');

            responseContainer.classList.add('visible');
            responseText.textContent = 'Thinking...';

            // Simulate AI delay
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Demo responses (in production, this would come from the API)
            let response = "";
            const lowerMessage = userMessage.toLowerCase();

            if (lowerMessage.includes('2 bhk') || lowerMessage.includes('2 bedroom')) {
                response = "I found several 2 BHK options in Mumbai! In Andheri West, there are 15 properties within your 80 lakh budget. Would you like me to tell you more about the top listings, or would you prefer a sales representative to call you with personalized recommendations?";
            } else if (lowerMessage.includes('3 bhk') || lowerMessage.includes('3 bedroom')) {
                response = "Great choice! There are many 3 bedroom apartments available near IT Park, Pune. The price range typically starts from 90 lakhs. Can you tell me your budget so I can narrow down the best options for you?";
            } else if (lowerMessage.includes('commercial') || lowerMessage.includes('shop')) {
                response = "For commercial properties around 50 lakhs in Delhi, I can see several shop spaces available in prime locations. Would you prefer ground floor or basement? This helps me find the best matches for your business needs.";
            } else if (lowerMessage.includes('bangalore') || lowerMessage.includes('whitefield')) {
                response = "Whitefield is an excellent choice! It's a rapidly developing area with great connectivity. What type of property are you looking for - an apartment or a villa? And what's your preferred budget range?";
            } else {
                response = "I understand you're looking for a property. To help you better, could you tell me: 1) The location you prefer, 2) Residential or Commercial, 3) Your budget range? This will help me find the perfect match for you.";
            }

            responseText.textContent = response;
            addToHistory('bot', response);

            // Speak the response (Text-to-Speech)
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(response);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                window.speechSynthesis.speak(utterance);
            }
        }

        function addToHistory(role, content) {
            conversationHistory.push({ role, content });

            const historyContainer = document.getElementById('historyContainer');
            const historyList = document.getElementById('historyList');

            historyContainer.classList.add('visible');

            const item = document.createElement('div');
            item.className = `history-item ${role}`;
            item.innerHTML = `
                <div class="history-role">${role === 'user' ? 'üë§ You' : 'üè† Assistant'}</div>
                <div class="history-content">${content}</div>
            `;

            historyList.insertBefore(item, historyList.firstChild);
        }

        function showApiDocs() {
            alert('API Documentation available at: ' + API_URL + '/docs');
            window.open(API_URL + '/docs', '_blank');
        }
    </script>
</body>

</html>